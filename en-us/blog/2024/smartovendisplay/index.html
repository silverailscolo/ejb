<!DOCTYPE html> <html lang="en-us"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, notranslate, noimageindex"> <title> Build an AGA Cooker Display | EJB's site </title> <meta name="author" content="EJ Broerse"> <meta name="description" content="Entertaining info on me and my occupations."> <meta name="keywords" content="architecture, house, trains"> <link rel="stylesheet" href="/ejb/assets/css/bootstrap.min.css?59683d8d628e6717785b508ec539c429"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/ejb/assets/css/academicons.min.css?9dbe0c76bacd463500b79ed6a86e27ac"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/ejb/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/ejb/en-us/assets/img/favicon.png?7de88881c5eea3dd7fcff1b84ec5f1bf"> <link rel="stylesheet" href="/ejb/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://silverailscolo.github.io/ejb/en-us/blog/2024/smartovendisplay/"> <link defer rel="stylesheet" href="/ejb/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/ejb/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/ejb/en-us/"> <div><img src="/ejb/assets/img/favicon.png" alt="Broerse"></div> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/architect/">architecture </a> </li> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/gallery/">collections </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">trains </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/ejb/en-us/trains/layout">my layout</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/rollingstock">my roster</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/trains/dcc">DCC</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/trains/prototype">prototype</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/trains/tips">tips</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">house </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/ejb/en-us/house/garden">garden</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/house/renovation">renovation</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/house/history">history</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/house/smart">smart home</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/house/ms15">first house</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">computers </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/ejb/en-us/computers/repositories">GitHub repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/computers/mymacs">my Macs</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/computers/macintosh">Mac tips</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/computers/lubuntu">Lubuntu tips</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/computers/playground">playground</a> </div> </li> <li class="nav-item active"> <a class="nav-link" href="/ejb/blog/2024/smartovendisplay/"> NL</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Build an AGA Cooker Display</h1> <p class="post-meta"> April 25, 2024 </p> <p class="post-tags"> <a href="/ejb/en-us/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/ejb/en-us/blog/tag/smart-home"> <i class="fa-solid fa-hashtag fa-sm"></i> smart-home</a>     ·   <a href="/ejb/en-us/blog/category/software"> <i class="fa-solid fa-tag fa-sm"></i> software</a>   <a href="/ejb/en-us/blog/category/hardware"> <i class="fa-solid fa-tag fa-sm"></i> hardware</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>As you may have read <a href="/ejb/en-us/house/smart.html#oven">here</a>, I wanted to build a reminder/indication for our AGA kitchen stove. This was my solution.</p> <figure><img src="/ejb/assets/img/house/smart/agadisplay_IMG9388.jpg" alt="The finished display in use" class="img-fluid"><figcaption class="kleiner">The finished display</figcaption></figure> <h3 id="hardware-items-needed">Hardware items needed</h3> <ul> <li><a href="https://www.raspberrypi.com/documentation/microcontrollers/raspberry-pi-pico.html" rel="external nofollow noopener" target="_blank">Raspberry Pico W</a></li> <li> <a href="https://www.waveshare.com/wiki/Pico-OLED-1.3" rel="external nofollow noopener" target="_blank">Waveshare 1.3” Pico OLED</a> display</li> <li>USB-A to USB-C cable</li> <li> <a href="https://thonny.org" rel="external nofollow noopener" target="_blank">Thonny IDE</a> for <a href="https://micropython.org" rel="external nofollow noopener" target="_blank">MicroPython</a> to program the picoW</li> <li> <a href="https://www.home-assistant.io" rel="external nofollow noopener" target="_blank">HomeAssistant</a> providing energy use via <a href="https://mqtt.org" rel="external nofollow noopener" target="_blank">MQTT</a> messages</li> <li>Automations set up in HomeAssistant responding to</li> <li>Current sensing input for your stove to HomeAssistant, eg. <a href="https://www.myenergi.com/product/harvi/" rel="external nofollow noopener" target="_blank">myenergi harvi</a> (2 CT clamps minimum on 3 Phase install)</li> </ul> <h3 id="current-sensing">Current Sensing</h3> <p>Near the switch board or in another safely accessible location, mount 2-3 CT-clamps on the feeders to the AGA stove. I ordered compact myenergi clamps.</p> <div class="row"> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/CT_clamps-IMG_9186.jpg" alt="CT clamps behind fuse box" class="img-fluid"><figcaption class="kleiner">CT clamps behind fuse box</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/harvi_inside-IMG_9183.jpg" alt="connections inside harvi" class="img-fluid"><figcaption class="kleiner">CT2/3 connections inside harvi</figcaption></figure> </div> I connected the CT clamp wires to the unused inputs of my harvi, which show up as sensors in the Home Assistant myenergi integration. ### Code Download the [micropython code](/ejb/assets/python/ovendisplay-main.py) and load it onto the PicoW using the Thony application. ### Home Assistant set-up In HomeAssistant, create input_number definitions in configuration.yaml; <figure><img src="/ejb/assets/img/house/smart/ha_ct2_inputnumber.png" alt="HA CT2 Input Setting Pane" class="img-fluid"><figcaption class="kleiner">CT2 Input Setting Pane</figcaption></figure> Add ON/OFF Automations for each element of your stove, for example to signal Baking Oven was turned ON: ``` alias: AGA Baking Oven ON description: "" trigger: - platform: numeric_state entity_id: - sensor.ct2_actueel_vermogen above: 820 below: 960 condition: [] action: - service: input_boolean.turn_on data: {} target: entity_id: input_boolean.aga_baking_oven mode: single ``` In HomeAssistant, add binary input_boolean (On/Off) sensors for each item on your stove, for example: ``` alias: AGA turns OFF CT2 description: "" trigger: - platform: numeric_state entity_id: - input_number.ct2_actueel below: 1 for: hours: 0 minutes: 1 seconds: 0 - platform: numeric_state entity_id: - sensor.ct2_ct3 below: 1 for: hours: 0 minutes: 1 seconds: 0 condition: [] action: - service: input_boolean.turn_off data: {} target: entity_id: - input_boolean.aga_grill - input_boolean.aga_baking_oven - input_boolean.aga_roasting_oven mode: single ``` <figure><img src="/ejb/assets/img/house/smart/ha_bakingoven_input_setting.png" alt="HA Oven Input Setting Pane" class="img-fluid"><figcaption class="kleiner">Input Oven Setting Panel</figcaption></figure> Add MQTT topics in HomeAssistant configuration.yaml: ``` mqtt_statestream: base_topic: homeassistant publish_attributes: false publish_timestamps: false include: entities: - input_boolean.aga_warming_oven - input_boolean.aga_boiling_plate - input_boolean.aga_simmer_plate - input_boolean.aga_baking_oven - input_boolean.aga_roasting_oven - input_boolean.aga_grill entity_globs: - input_boolean.aga_* # MQTT subscribe to PicoW mqtt: sensor: - name: "Timer A" unique_id: "timer_a" state_topic: "picow/timerA/running" - name: "Timer B" unique_id: "timer_b" state_topic: "picow/timerB/running" ``` More on MQTT for sensors from PicoW micropython [here](https://github.com/agners/micropython-ha-mqtt-device) Adapt for your use case, eg. - MQTT messages format - Connection names and trigger currents of your stove elements (look at sensor.ct2\_ above) Because the [myenergi harvi](https://www.myenergi.com/product/harvi/) is powered from the CT clamps, a bit more tweaking is required. To reset the current sensors to zero when no PV or AGA current is flowing through the clamps, I created a 2 minute timer that is reset every minute as a (non-zero) measurement from the myenergi server arrives in Home Assistant myenergi integration. When this timer eventually runs out, it means neither the PV panels nor the stove is consuming any power, and an automation sets `input_number.ct2_actueel` and `input_number.ct3_actueel` back to zero. If you need those details, open an [Issue](https://github.com/silverailscolo/ejb/issues) on this site. </div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2024/goodbye-hypersite/">Hypersite stack</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2017/assembling-kit-rlw-k27/">Assembling the RLW Nn3 K-27 kit</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2018/hdl-locobuffer-installation-issue-fixed/">HDL LocoBooster installation issue fixed</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2018/translation-dilemmas/">Translation Dilemmas</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2015/git-it/">Git it?</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 EJ Broerse. <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en-us" rel="external nofollow noopener" target="_blank"><img decoding="async" loading="lazy" src="https://silverailscolo.github.io/ejb/assets/img/by-nc-sa.png" width="117" height="41" alt="CC BY-NC-SA 4.0" style="float: right;"></a> <br> Last updated: Apr 25, 2024 </div> </footer> <script src="/ejb/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/ejb/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/ejb/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/ejb/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/ejb/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/ejb/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/ejb/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>