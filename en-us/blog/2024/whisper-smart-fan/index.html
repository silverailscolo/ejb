<!DOCTYPE html> <html lang="en-us"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, notranslate, noimageindex"> <title> Build a smart-fan | EJB's site </title> <meta name="author" content="EJ Broerse"> <meta name="description" content="Entertaining info on me and my occupations."> <meta name="keywords" content="architecture, house, trains"> <link rel="stylesheet" href="/ejb/assets/css/bootstrap.min.css?59683d8d628e6717785b508ec539c429"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/ejb/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/ejb/en-us/assets/img/favicon.png?7de88881c5eea3dd7fcff1b84ec5f1bf"> <link rel="stylesheet" href="/ejb/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://silverailscolo.github.io/ejb/en-us/blog/2024/whisper-smart-fan/"> <link defer rel="stylesheet" href="/ejb/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/ejb/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/ejb/en-us/"> <div><img src="/ejb/assets/img/favicon.png" alt="Broerse"></div> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/architect/">architecture </a> </li> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/ejb/en-us/gallery/">collections </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">trains </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/ejb/en-us/trains/layout">my layout</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/rollingstock">my roster</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/trains/dcc">DCC</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/trains/prototype">prototype</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/trains/tips">tips</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">house </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/ejb/en-us/house/garden">garden</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/house/renovation">renovation</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/house/history">history</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/house/smart">smart home</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/house/ms15">first house</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">computers </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/ejb/en-us/computers/repositories">GitHub repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/computers/mymacs">my Macs</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/computers/macintosh">Mac tips</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/computers/lubuntu">Lubuntu tips</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/ejb/en-us/computers/playground">playground</a> </div> </li> <li class="nav-item active"> <a class="nav-link" href="/ejb/blog/2024/whisper-smart-fan/"> NL</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Build a smart-fan</h1> <p class="post-meta"> August 3, 2024 </p> <p class="post-tags"> <a href="/ejb/en-us/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/ejb/en-us/blog/tag/smart-home"> <i class="fa-solid fa-hashtag fa-sm"></i> smart-home</a>     ·   <a href="/ejb/en-us/blog/category/software"> <i class="fa-solid fa-tag fa-sm"></i> software</a>   <a href="/ejb/en-us/blog/category/hardware"> <i class="fa-solid fa-tag fa-sm"></i> hardware</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>To bring fresh air into our bedroom we had a decentral HRU installed, but is was too noisy to catch much sleep…<br> Because we prefer a temperature of 18˚C, heat recovery in ouw climate zone isn/t that useful. Because space was stille limited, I installe en axial fan with variable speed EC motor connected to an ESP32 the revs it up when the CO<sub>2</sub>-level nears 800 ppm. Read on for our setup:</p> <figure><img src="/ejb/assets/img/house/smart/whisper/whisper_complete.jpg" alt="The complete fan install" class="img-fluid"><figcaption class="kleiner">The complete fan install</figcaption></figure> <h3 id="hardware-used">Hardware used</h3> <ul> <li>Axial fan Ø125mm with variable speed EC motor, eg. the <a href="https://www.ventilatieshop.com/buisventilatoren/whisper-buisventilator/whisper-gold-line-buisventilator-diameter-100mm-125mm-ec-motor-wgle/" rel="external nofollow noopener" target="_blank">Whisper Gold Line EC</a>. You don’t need the 10V controller, but order some spiral tubes, a muffler and connection pieces.</li> <li> <a href="https://shop.m5stack.com/products/atom-lite-esp32-development-kit" rel="external nofollow noopener" target="_blank">M5 Stack Atom Lite</a>. A compact 25x25mm SOC with built-in RGB-led and button. I ordered my Atom <a href="https://www.tinytronics.nl/nl/development-boards/microcontroller-boards/met-wi-fi/m5stack-atom-lite-esp32-development-board" rel="external nofollow noopener" target="_blank">here</a> </li> <li>USB-A to USB-C cable</li> <li>A <a href="https://www.tinytronics.nl/nl/schakelaars/mosfet's/irf520-breakout-module" rel="external nofollow noopener" target="_blank">IRF520 MOSFET breakout</a> to boost the PWM-signaal from the Atom pin for the 10V= fan control</li> <li> <a href="https://www.home-assistant.io" rel="external nofollow noopener" target="_blank">HomeAssistant</a> with <a href="https://esphome.io/guides/getting_started_hassio" rel="external nofollow noopener" target="_blank">ESPHome Add-on</a> IDE to write and install code on the Atom and interact with the unit</li> <li>Automatations on the Atom Lite (ESP32), written with ESPHome, to make it respond to</li> <li>CO<sub>2</sub>-sensor integrated in HomeAssistant, eg. <a href="https://shop.netatmo.com/nl-nl/aircare/home-coach/homecoach" rel="external nofollow noopener" target="_blank">Netatmo Healthy Home Coach</a> (this info can appear in HomeKit too, using the HomeAssistant <a href="https://www.home-assistant.io/integrations/homekit" rel="external nofollow noopener" target="_blank">HomeKit Bridge</a>, but it doesn’t work directly from HomeKit.</li> </ul> <h3 id="co2-meten">CO<sub>2</sub> meten</h3> <p>Place the CO<sub>2</sub> sensor in your bedroom and add the <a href="https://www.home-assistant.io/integrations/homekit_controller" rel="external nofollow noopener" target="_blank">HomeKit Controller</a> integration in HomeAssistant to display the readings and use them to control the fan speed.</p> <div class="row"> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/ha_netamo_homekit.png" alt="Healthy Home integration in HomeAssistant" class="img-fluid"><figcaption class="kleiner">Healthy Home integration in HomeAssistant</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/ha_co2_sensor.png" alt="Original CO2-graph in HomeAssistant" class="img-fluid"><figcaption class="kleiner">CO<sub>2</sub> levels without fan</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/ha_co2_control.png" alt="CO2-graph in HomeAssistant with automatic fan" class="img-fluid"><figcaption class="kleiner">CO<sub>2</sub> levels with the automatic fan</figcaption></figure> </div> </div> <h3 id="fan-connections">Fan connections</h3> <p>Install the fan, ducts and muffler next to your bedroom. I Found a space over the closets in an adjoining guest room, that will profit as well.</p> <p>You will need mains sockets for both the Whisper Gold Line fan and a 5V USB adapter that will power the M5 Stack Atom.</p> <p>The Whisper Gold shipment included a spline box for both 230V power and the 4 control wires:</p> <div class="row"> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/whisper_wiring.jpg" alt="Whisper wiring diagram" class="img-fluid"><figcaption class="kleiner">Whisper wiring diagram from the manual</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/whisper_wires.jpg" alt="Whisper connections" class="img-fluid"><figcaption class="kleiner">Whisper connections</figcaption></figure> </div> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/Atom-Whisper-Connections.png" alt="Wiring diagram of all parts" class="img-fluid"><figcaption class="kleiner">Wiring diagram of all parts</figcaption></figure> </div> <h3 id="m5-atom-lite-connections">M5 Atom Lite connections</h3> <div class="row"> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/atom_lite_wires.jpg" alt="Rear Connector on the Atom Lite" class="img-fluid"><figcaption class="kleiner">Rear Connector on the Atom Lite</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/atom-lite-installed.jpg" alt="Atom Lite ESP32 controller mounted in room" class="img-fluid"><figcaption class="kleiner">Atom Lite ESP32 controller mounted in room</figcaption></figure> </div> </div> <p>From the fan I ran 2x2 wires in a piece of UTP-cable to power the Atom with 5V= and connect two pins to control the fan. You need just a single line of four 2.54 mm female sockets at the back of the Atom, see picture. GPIO25 (orange) is our PWM-output. GPIO21 (orange/white) is used as input for the tacho pulse from the fan.</p> <p>After booting, the color of the Lite indicates the CO<sub>2</sub>-level (Green &lt; 500, Red &gt; 800). The brightness of the led shows the fan speed: brighter = faster. A click on the button will set fan operation to manual and increase the speed by 10%. When at 80% the next click sets operation to Automatic, The next click turns the fan off eg. for when you are away for a couple of days.</p> <h3 id="atom-lite-code">Atom Lite code</h3> <p>Download the <a href="/ejb/en-us/assets/yaml/whisper/esphome_m5atomlite-whisper.yaml">yaml code</a> and upload it to the M5Stack Atom Lite (ESP32) using the HomeAssistant ESPHome IDE. When this is your first application on the Atom Lite open Chrome browser and navigate to <a href="https://web.esphome.io/?dashboard_wizard" rel="external nofollow noopener" target="_blank">ESPhome Web</a>, connect the USB cable from the Atom to your computer, click Connect and select your USB port.</p> <div class="row"> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/esphome-connect.png" alt="In ESPhome Web, select Connect" class="img-fluid"><figcaption class="kleiner">In ESPhome Web select Connect</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/esphome-port.png" alt="Select the USB port on your PC" class="img-fluid"><figcaption class="kleiner">Select the USB port on your PC</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/esphome-prepare.png" alt="Progress of initial install" class="img-fluid"><figcaption class="kleiner">Progress of initial install</figcaption></figure> </div> </div> <p>The ESP32 configuration consists of:</p> <p>Basic setup:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>esphome:
  name: m5atomlite-whisper
  friendly_name: M5Atom Lite Whisper

globals:
  - id: speed_set_int
    type: int
    restore_value: yes
    initial_value: '4'
  - id: automatic_co2
    type: int
    restore_value: yes
    initial_value: '1'

esp32:
  board: m5stack-atom
  framework:
    type: arduino
</code></pre></div></div> <p>Create a speed_fan object:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fan:
  - platform: speed
    id: whisper_fan
    name: "Slaapkamer Ventilator"
    output: whisper_fan_pwm
    speed_count: 10
    on_turn_on:
      # publish set speed
      - sensor.template.publish:
          id: whisper_speed_step
          state: !lambda 'return id(whisper_fan).speed;'
    on_turn_off:
      # publish set speed
      - sensor.template.publish:
          id: whisper_speed_step
          state: 0
      # set brightness
      - light.turn_off:
          id: led
    on_speed_set:
      # publish set speed
      - sensor.template.publish:
          id: whisper_speed_step
          state: !lambda 'return id(whisper_fan).speed;'
      # set brightness
      - lambda: |-
          // adjust brightness for any speed change
          auto call = id(led).make_call();
          call.set_state(true); // turn the light on if it was off
          auto n = 0.05 * id(speed_set_int);
          call.set_brightness(n);
          call.perform();
</code></pre></div></div> <p>Create a PWM output to control the fan speed:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>output:
  - platform: ledc
    # Fan PWM
    # Connect MOS-SIG to GPIO25, MOS-GND to GND; Whisper yellow to MOS V-, black to OUT-GND, red to OUT+10V
    id: whisper_fan_pwm
    pin:
      number: GPIO25
      inverted: true # MOS V+ did not work. V- did, so inverted PIN
    frequency: 10000Hz # lower if it whines
</code></pre></div></div> <p>A button (switch) to set Automatic operation:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>switch:
  - platform: template
    id: automatic
    name: Automatische regeling
    lambda: |-
      if (id(automatic_co2) == 1){
        return true;
      } else {
        return false;
      }
    turn_on_action:
      then:
      - fan.turn_on:
          id: whisper_fan
      - lambda: |-
          id(automatic_co2) = 1;
          // next block to match thresholds in sensor.co2_measurement block above
          ESP_LOGD("ATOM", "Whisper Auto ON, CO2: %d", id(co2_measurement).state);
          if (id(co2_measurement).state &gt; 1300) {
            id(speed_set_int) = 8;
          } else if (id(co2_measurement).state &gt; 800.0){
            id(speed_set_int) = 7;
          } else if (id(co2_measurement).state &gt; 700.0){
            id(speed_set_int) = 6;
          } else if (id(co2_measurement).state &gt; 600.0){
            id(speed_set_int) = 5;
          } else if (id(co2_measurement).state &gt; 450.0){
            id(speed_set_int) = 4;
          } else if (id(co2_measurement).state &gt; 350.0){
            id(speed_set_int) = 3;
          } else {
            id(speed_set_int) = 0;
          }
          id(whisper_fan).speed = id(speed_set_int);
    turn_off_action:
      then:
      - lambda: |-
          id(automatic_co2) = 0;
</code></pre></div></div> <p>A sensor to fetch CO<sub>2</sub> sensor data from HomeAssistant to the ESP32:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sensor:
  - platform: homeassistant
    id: co2_measurement # this is the ID for a new local sensor, and copies:
    entity_id: sensor.healthy_home_coach_netatmo_carbon_dioxide_sensor  # this points to the front end (Netatmo) entity
    unit_of_measurement: 'ppm'
    filters:
      - round: 0
    on_value_range: # next block to match thresholds in switch.automatic_co2 block below
      - above: 0
        below: 350.0
        then:
          - if:
              condition:
                lambda: return id(automatic_co2) == 1;
              then:
                fan.turn_off:
                  id: whisper_fan
          - light.turn_off:
              id: led
          #- logger.log: CO2 &lt; 350 ppm
      - above: 350.1
        below: 450.0
        then:
          - if:
              condition:
                lambda: return id(automatic_co2) == 1;
              then:
                fan.turn_on:
                  id: whisper_fan
                  speed: 3
          - light.turn_on:
              id: led
              red: 0
              green: 100%
              blue: 0
          #- logger.log: 350 &lt; CO2 &lt; 450 ppm
      # ETC.
      - above: 1300.1
        then:
          - if:
              condition:
                lambda: return id(automatic_co2) == 1;
              then:
                fan.turn_on:
                  id: whisper_fan
                  speed: 8
          - light.turn_on:
              id: led
              red: 100%
              green: 0%
              blue: 50%
          #- logger.log: WARNING CO2 &gt; 1300 ppm
</code></pre></div></div> <p>When the fan is in Automatic mode, the code will adjust the fan speed every time it receives a new CO<sub>2</sub> reading from the bedroom. It also updates the color of the LED (Green = clean to Brown = dirty).</p> <p>The tachometer sensor provides feedback on the actual Whisper fan speed (3 pulses per revolution, so we have the <code class="language-plaintext highlighter-rouge">multiply: 0.33</code> filter):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sensor:
  - platform: pulse_counter # -meter too many data points
    # toerenteller Whisper witte draad
    name: Toerental
    id: whisper_toerental
    pin:
      number: GPIO21
      # inverted: true
      mode:
        input: true
        pullup: true
    unit_of_measurement: 't/min'
    internal_filter: 5us
    update_interval: 10s
    filters:
      - multiply: 0.33 # (3 ticks per revolution as per Whisper Gold manual)
      - round: 0
</code></pre></div></div> <h3 id="home-assistant-settings">Home Assistant settings</h3> <p>Back in HomeAssistant open the YAML-editor mode of a new Dashboard and paste in this <a href="assets/yaml/whisper/homeassistant_whisper_dashboard.yaml">yaml code</a> to create the fan control UI.</p> <p>Adapt the entity names to your setup, eg.</p> <ul> <li>The name of your CO<sub>2</sub> sensor</li> <li>The numbers for your speed_fan, fan sensors and -switches</li> </ul> <div class="row"> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/whisper_ha_dashboard.jpg" alt="HA Whisper fan Dashboard" class="img-fluid"><figcaption class="kleiner">Whisper Fan Dashboard in HomeAssistant</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/ejb/assets/img/house/smart/whisper/HA-whisper-speed-graph.png" alt="Fan speed reacts to CO2 measurements" class="img-fluid"><figcaption class="kleiner">Fan speed reacts to CO2 measurements</figcaption></figure> </div> </div> <p>I wish you all fresh nights!</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2024/goodbye-hypersite/">Goodbye Hypersite</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2024/smartovendisplay/">Build an AGA Cooker Display</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2017/assembling-kit-rlw-k27/">Assembling the RLW Nn3 K-27 kit</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2019/rio_grande_signal/">Kitbash a Rio Grande signal mast</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/ejb/en-us/blog/2018/hdl-locobuffer-installation-issue-fixed/">HDL LocoBooster installation issue fixed</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 EJ Broerse. <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en-us" rel="external nofollow noopener" target="_blank"><img decoding="async" loading="lazy" src="https://silverailscolo.github.io/ejb/assets/img/by-nc-sa.png" width="117" height="41" alt="CC BY-NC-SA 4.0" style="float: right;"></a> <br> Last updated: Aug 3, 2024 </div> </footer> <script src="/ejb/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/ejb/assets/js/masonry.js" type="text/javascript"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>