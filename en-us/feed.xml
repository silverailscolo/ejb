<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://silverailscolo.github.io/en-us/feed.xml" rel="self" type="application/atom+xml"/><link href="https://silverailscolo.github.io/en-us/" rel="alternate" type="text/html"/><updated>2025-12-31T14:27:16+00:00</updated><id>https://silverailscolo.github.io/feed.xml</id><title type="html">EJB’s site</title><entry xml:lang="en-us"><title type="html">Meet Ramses</title><link href="https://silverailscolo.github.io/en-us/blog/2025/ramses/" rel="alternate" type="text/html" title="Meet Ramses"/><published>2025-12-29T00:00:00+00:00</published><updated>2025-12-29T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2025/ramses</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2025/ramses/"><![CDATA[<p>I already had <a href="../../../house/smart.shtml">HomeAssistant</a> running at home. Using so-called <em>Integrations</em> you can link various ‘smart’ hardware brands to his home automation system. What ‘smart’ devices do you have in your home? Manufacturers sometimes offers an app to control their devices. Those apps often pass all your data via a cloud (server on the internet): a security risk, and limited to what data the manufacturer wants to expose. A few examples:</p> <ul> <li>Ikea Tradfri: <strong>Ikea Smart</strong> app + Tradfri hub</li> <li>Tuya Smart: <strong>Tuya</strong> app + Tuya bridge</li> <li>Nibe heat pump: <strong>MyUplink</strong> app + UTP</li> <li>Luxaflex shutters: <strong>PowerView</strong> app + bridge</li> <li>Casambi lamps (bluetooth): <strong>Air</strong> app + iPhone as BLE bridge</li> <li>Honeywell thermostat, Itho ventilation: <strong>evohome</strong> + RF bridge</li> </ul> <h3 id="some-have-an-api">Some have an API</h3> <p>Some manufacturers share the data their app uses as an application programming interface <a href="https://nl.wikipedia.org/wiki/Application_programming_interface">API</a> to which HA can connect. If they don’t, you have to find out for yourself what data is passed around via Zigbee, WiFo or Bluetooth, next try to understand what all that data means and how you can imitate some of it. When they apply advanced <em>encryption</em>, reverse-engineering aq protocol is nearly impossible!</p> <p>As Open Source python programms, people code Integrations for <a href="https://www.home-assistant.io/">HomeAssistant</a> (HA). I installed a few in HA, such as PowerView and Ikea Tradfri. From a privacy and security standpoint it is preferred to connect directly to a device, bypassing these APIs.</p> <p>For our <a href="https://www.nibe.eu/en-gb/products/heat-pumps/ground-source-heat-pumps">Nibe F1255</a> heat pump there is a Swedish program that connects to the ModBus connection instead of via the API, and sends/receives MQTT messages via Wi-Fi on a <a href="https://www.raspberrypi.com/products/raspberry-pi-zero-2-w/">PiZero</a> microcontroller.</p> <h2 id="hvac-integrations">HVAC Integrations?</h2> <p>Our HRV fans in the bathroom, bedroom and living room come with an (expensive €100) wireless RF switch. But wouldn’t it be useful to switch them on at certain times, e.g. when you turn on the light in the toilet, or in the morning after getting up on high for an hour?</p> <p>The manufacturers did not provide any technical information about how the switches “talk” to the fans. On the contrary, they prefer not to have you touch their default settings for fear that complaints will arise. And they want to make money from their “knowledge” by shielding it and only allow professional mechanics to access this information. And they don’t like to share that info either (if they are allowed to do so at all).</p> <h3 id="not-for-climarad">Not for ClimaRad</h3> <p>So I opened my <a href="https://www.climarad.nl/">ClimaRad</a> HRU - which did not come with a remote control - myself and found a circuit board with an antenna there. Through the stickers I learned that it was an RF antenna and that the print was produced by [Airios] in Holland.</p> <p>A phone call to Airios didn’t help: “You must contact ClimaRad”. <a href="https://www.airios.eu/">Airios</a> appears to be originally the consumer branch of Honeywell/<a href="https://www.resideo.com/nl/nl/">Resideo</a>.</p> <h3 id="meet-ramses-rf">Meet Ramses RF</h3> <p>And with that info I ended up with the open source HA integration <a href="https://github.com/ramses-rf">Ramses RF</a>, written in python by David Bonnes. From 2021 onwards, he and Peter Price figured out the messages they received with an 868MHz antenna (Ramses-II protocol). They developed the first hardware and software to control heating and DHW (hot tap water) as (evohome; HEAT). Dutch users supplemented the code to also control ventilation (<a href="https://www.ithodaalderop.nl/">Itho</a>, <a href="https://orcon.nl/">Orcon</a>, <a href="https://www.nuaire.co.uk/">Nuaire</a>; HVAC).</p> <p>But our fans and heat recovery units (NL: WTW, EN: HRU for heat recovery unit) from Vasco and ClimaRad did not work with Ramses RF at the time, so I started writing extra code for that. When that code worked well here in the house, I asked David if he wanted to include the code in a new version that all users can install. But he was concerned that my changes could cause problems with other users. He also indicated that his work meant that he had too little time to keep Ramses RF up-to-date and wrote in the repository that he wanted to transfer everything to a new administrator. After 4 months, I took over that task from David in mid-2025. Due to announced changes in HomeAssistant, the Ramses RF integration would no longer work by the end of 2025, so those became my new priorities:</p> <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked"/>Blocking file IO during startup</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked"/>Outdated (non) entity schemas</li> </ul> <h2 id="links">Links</h2> <ul> <li>HA User Forum: <a href="https://community.home-assistant.io/t/honeywell-ch-dhw-via-rf-evohome-sundial-hometronics-chronotherm/">Ramses RF thread</a></li> <li>Repo lib: https://github.com/ramses-rf/ramses_rf</li> <li>Repo integration: https://github.com/ramses-rf/ramses_cc</li> <li>Wiki: https://github.com/ramses-rf/ramses_cc/wiki</li> <li>Pypi: https://pypi.org/project/ramses-rf/</li> </ul> <h3 id="pyairios">pyairios</h3> <p>Unfortunately, I also discovered that I could not control my ClimaRad Ventura HRU with Ramses RF (HA can read it, but you can’t connect a remote to it). Samuel Cabrero from Spain happened to release a solution at the beginning of 2025: using an Airios RF Bridge with the <a href="https://github.com/scabrero/pyairios">pyairios</a> library and airios HA-integration, Search for “airios + ramses”. See:</p> <ul> <li>my <a href="https://github.com/silverailscolo/homeassistant-airios-component">homeassistant-airios-component fork</a></li> <li>my <a href="https://github.com/silverailscolo/pyairios">pyairios fork</a></li> </ul>]]></content><author><name></name></author><category term="computers"/><category term="smart-home"/><summary type="html"><![CDATA[I already had HomeAssistant running at home. Using so-called Integrations you can link various ‘smart’ hardware brands to his home automation system. What ‘smart’ devices do you have in your home? Manufacturers sometimes offers an app to control their devices. Those apps often pass all your data via a cloud (server on the internet): a security risk, and limited to what data the manufacturer wants to expose. A few examples: Ikea Tradfri: Ikea Smart app + Tradfri hub Tuya Smart: Tuya app + Tuya bridge Nibe heat pump: MyUplink app + UTP Luxaflex shutters: PowerView app + bridge Casambi lamps (bluetooth): Air app + iPhone as BLE bridge Honeywell thermostat, Itho ventilation: evohome + RF bridge]]></summary></entry><entry xml:lang="en-us"><title type="html">Display a slip an a CPE panel</title><link href="https://silverailscolo.github.io/en-us/blog/2025/jmri-cpe-slip/" rel="alternate" type="text/html" title="Display a slip an a CPE panel"/><published>2025-01-14T00:00:00+00:00</published><updated>2025-01-14T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2025/jmri-cpe-slip</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2025/jmri-cpe-slip/"><![CDATA[<h2 id="how-to-put-a-double-slip-on-a-jmri-control-panel">How to put a double slip on a JMRI Control Panel</h2> <p>On my layout a remote double slip connects the Ouray loop in Silverton. To display this turnout on a Layout Editor panel or a classic Panel is straight forward using a dedicated tool. But in Control Panel Editor (CPE) the so-called Turnout Indicator element that can show occupancy and route assignment is not available for 3-way turnouts and slips (see <a href="https://www.jmri.org/help/en/package/jmri/jmrit/display/ControlPanelEditor.shtml">docs</a>).</p> <figure><img src="/assets/img/trains2/jmri/jmri-le-slipedit-en.png" alt="LE slip edit pane" class="img-fluid"/><figcaption class="kleiner">LE slip edit pane</figcaption></figure> <p>My slip turnout LT2 has only two states to operate, whilst the LE slip/3-way tool expects two turnout addresses for at least 3 states. Relay LT1 flips the return loop DCC track power to match the feeders to the slip and beyond to prevent a short. Using these 2 turnout addresses we can create a representation on the CPE panel:</p> <table> <thead> <tr> <th>LT1 (loop relay, left half)</th> <th>IT2 (right half of icon)</th> <th>LT2 (2-state remote slip)</th> </tr> </thead> <tbody> <tr> <td>closed</td> <td>thrown</td> <td>thrown</td> </tr> <tr> <td>closed</td> <td>closed</td> <td>closed</td> </tr> <tr> <td>thrown</td> <td>thrown</td> <td>closed</td> </tr> <tr> <td>thrown</td> <td>closed</td> <td>thrown</td> </tr> </tbody> </table> <figure><img src="/assets/img/trains2/jmri/slip-logic-table.png" alt="Logic table LT1 + IT2 &gt; LT2" class="img-fluid"/><figcaption class="kleiner">Logic table LT1 + IT2 &gt; LT2</figcaption></figure> <p>The slip is operated via two indicator turnout icons displayed on the panel. A JMRI Logix checks the State of both and sets LT2 to match the logic table. (Routes can use only one commanding turnout, so they would require a sensor to track the second turnout).</p> <figure><img src="/assets/img/trains2/jmri/jmri-logix-edit.png" alt="Screen shot of Logix config pane" class="img-fluid"/><figcaption class="kleiner">Screen shot of Logix config pane</figcaption></figure> <p>The slip turnout icon on the Control Panel is actually made from two halfs placed back-to-back. Each indicator part uses an icon map of 4 x 4 .png afbeeldingen:</p> <figure><img src="/assets/img/trains2/jmri/slip-icon-set-en.png" alt="Edit screen for icon map" class="img-fluid"/><figcaption class="kleiner">Edit screen for icon map</figcaption></figure> <p>The image map for both halves of the slip icon was trimmed from a normal indicator turnout icon set, with the left side rotated 180 degrees. Download a zip containing the special icons I created <a href="/en-us/assets/downloads/jmriprefs-resources-slip.zip">here</a> and copy its contents to the JMRI preferences/resources folder.</p> <div class="row"> <div class="col-sm"> <figure><img src="/assets/img/trains2/jmri/cpe-slip-c.png" alt="Slip icon in operation showing closed" class="img-fluid"/><figcaption class="kleiner">Slip icon closed</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/trains2/jmri/cpe-slip-t.png" alt="Slip icon in operation showing thrown" class="img-fluid"/><figcaption class="kleiner">Slip icon thrown</figcaption></figure> </div> </div> <p>The panel file was tweaked in a text editor, but you could do this using the UI tool too. Work on a copy of the panel file to prevent errors in JMRI. The good thing was that there was no need to dive deep into the CPE Java code and extend a class plus a tool. Enjoy warrant operations!</p> <h3 id="panel-xml-snippet">Panel xml snippet</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;indicatorturnouticon x="352" y="93" level="7" forcecontroloff="false" hidden="no" positionable="true" showtooltip="true" editable="true" degrees="180" class="jmri.jmrit.display.configurexml.IndicatorTurnoutIconXml"&gt;
  &lt;tooltip&gt;OBlock "Sv Crossing"&lt;/tooltip&gt;
  &lt;turnout&gt;IT2&lt;/turnout&gt;
  &lt;occupancyblock&gt;OB:AUTO:0003&lt;/occupancyblock&gt;
  &lt;showTrainName&gt;no&lt;/showTrainName&gt;
  &lt;iconmaps family="sliphalf-right"&gt;
    &lt;OccupiedTrack&gt;
      &lt;BeanStateUnknown url="preference:resources/slip/unknown-sliphalf-yellow.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateUnknown&gt;
      &lt;TurnoutStateClosed url="preference:resources/slip/closed-sliphalf-yellow.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateClosed&gt;
      &lt;TurnoutStateThrown url="preference:resources/slip/thrown-sliphalf-yellow.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateThrown&gt;
      &lt;BeanStateInconsistent url="preference:resources/slip/error-sliphalf-yellow.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateInconsistent&gt;
    &lt;/OccupiedTrack&gt;
    &lt;ClearTrack&gt;
      &lt;BeanStateUnknown url="preference:resources/slip/unknown-sliphalf-white.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateUnknown&gt;
      &lt;TurnoutStateClosed url="preference:resources/slip/closed-sliphalf-white.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateClosed&gt;
      &lt;TurnoutStateThrown url="preference:resources/slip/thrown-sliphalf-white.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateThrown&gt;
      &lt;BeanStateInconsistent url="preference:resources/slip/error-sliphalf-white.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateInconsistent&gt;
    &lt;/ClearTrack&gt;
    &lt;AllocatedTrack&gt;
      &lt;BeanStateUnknown url="preference:resources/slip/unknown-sliphalf-green.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateUnknown&gt;
      &lt;TurnoutStateClosed url="preference:resources/slip/closed-sliphalf-green.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateClosed&gt;
      &lt;TurnoutStateThrown url="preference:resources/slip/thrown-sliphalf-green.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateThrown&gt;
      &lt;BeanStateInconsistent url="preference:resources/slip/error-sliphalf-green.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateInconsistent&gt;
    &lt;/AllocatedTrack&gt;
    &lt;DontUseTrack&gt;
      &lt;BeanStateUnknown url="preference:resources/slip/unknown-sliphalf-gray.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateUnknown&gt;
      &lt;TurnoutStateClosed url="preference:resources/slip/closed-sliphalf-gray.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateClosed&gt;
      &lt;TurnoutStateThrown url="preference:resources/slip/thrown-sliphalf-gray.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateThrown&gt;
      &lt;BeanStateInconsistent url="preference:resources/slip/error-sliphalf-gray.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateInconsistent&gt;
    &lt;/DontUseTrack&gt;
    &lt;PositionTrack&gt;
      &lt;BeanStateUnknown url="preference:resources/slip/unknown-sliphalf-blue.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateUnknown&gt;
      &lt;TurnoutStateClosed url="preference:resources/slip/closed-sliphalf-blue.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateClosed&gt;
      &lt;TurnoutStateThrown url="preference:resources/slip/thrown-sliphalf-blue.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateThrown&gt;
      &lt;BeanStateInconsistent url="preference:resources/slip/error-sliphalf-blue.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateInconsistent&gt;
    &lt;/PositionTrack&gt;
    &lt;ErrorTrack&gt;
      &lt;BeanStateUnknown url="preference:resources/slip/unknown-sliphalf-red.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateUnknown&gt;
      &lt;TurnoutStateClosed url="preference:resources/slip/closed-sliphalf-red.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateClosed&gt;
      &lt;TurnoutStateThrown url="preference:resources/slip/thrown-sliphalf-red.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/TurnoutStateThrown&gt;
      &lt;BeanStateInconsistent url="preference:resources/slip/error-sliphalf-red.png" degrees="180" scale="1.0"&gt;
        &lt;rotation&gt;0&lt;/rotation&gt;
      &lt;/BeanStateInconsistent&gt;
    &lt;/ErrorTrack&gt;
  &lt;/iconmaps&gt;
&lt;/indicatorturnouticon&gt;
</code></pre></div></div> <p>Add a copy for the other half of the slip (LT1).</p> <h3 id="logix-xml">Logix xml</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;logixs class="jmri.managers.configurexml.DefaultLogixManagerXml"&gt;
  &lt;logix userName="Sv slip LT2" enabled="yes"&gt;
    &lt;systemName&gt;IX:RTX:IO:AUTO:0008&lt;/systemName&gt;
    &lt;userName&gt;Sv slip LT2&lt;/userName&gt;
    &lt;comment&gt;Silverton crossing&lt;/comment&gt;
    &lt;logixConditional systemName="IX:RTX:IO:AUTO:00081T" order="0" /&gt;
    &lt;logixConditional systemName="IX:RTX:IO:AUTO:0008C2" order="1" /&gt;
    &lt;logixConditional systemName="IX:RTX:IO:AUTO:0008C3" order="2" /&gt;
    &lt;logixConditional systemName="IX:RTX:IO:AUTO:0008C4" order="3" /&gt;
  &lt;/logix&gt;
&lt;/logixs&gt;
&lt;conditionals class="jmri.managers.configurexml.DefaultConditionalManagerXml"&gt;
  &lt;conditional systemName="IX:RTX:IO:AUTO:0008C2" userName="slip NW-SE" antecedent="R1 and R2" logicType="1" triggerOnChange="yes"&gt;
    &lt;systemName&gt;IX:RTX:IO:AUTO:0008C2&lt;/systemName&gt;
    &lt;userName&gt;slip NW-SE&lt;/userName&gt;
    &lt;conditionalStateVariable operator="4" negated="no" type="3" systemName="Loop reverse relay" dataString="" num1="0" num2="0" triggersCalc="yes" /&gt;
    &lt;conditionalStateVariable operator="1" negated="no" type="3" systemName="slip-east" dataString="" num1="0" num2="0" triggersCalc="yes" /&gt;
    &lt;conditionalAction option="1" type="17" systemName="LT2" data="2" delay="1" string="1" /&gt;
  &lt;/conditional&gt;
  &lt;conditional systemName="IX:RTX:IO:AUTO:0008C3" userName="slip W-E" antecedent="R1 and R2" logicType="1" triggerOnChange="yes"&gt;
    &lt;systemName&gt;IX:RTX:IO:AUTO:0008C3&lt;/systemName&gt;
    &lt;userName&gt;slip W-E&lt;/userName&gt;
    &lt;conditionalStateVariable operator="4" negated="no" type="4" systemName="Loop reverse relay" dataString="" num1="0" num2="0" triggersCalc="yes" /&gt;
    &lt;conditionalStateVariable operator="1" negated="no" type="4" systemName="slip-east" dataString="" num1="0" num2="0" triggersCalc="yes" /&gt;
    &lt;conditionalAction option="1" type="17" systemName="Sv Slip" data="2" delay="1" string="1" /&gt;
  &lt;/conditional&gt;
  &lt;conditional systemName="IX:RTX:IO:AUTO:0008C4" userName="slip W-SE" antecedent="R1 and R2" logicType="1" triggerOnChange="yes"&gt;
    &lt;systemName&gt;IX:RTX:IO:AUTO:0008C4&lt;/systemName&gt;
    &lt;userName&gt;slip W-SE&lt;/userName&gt;
    &lt;conditionalStateVariable operator="4" negated="no" type="4" systemName="Loop reverse relay" dataString="" num1="0" num2="0" triggersCalc="yes" /&gt;
    &lt;conditionalStateVariable operator="1" negated="no" type="3" systemName="slip-east" dataString="" num1="0" num2="0" triggersCalc="yes" /&gt;
    &lt;conditionalAction option="1" type="17" systemName="Sv Slip" data="4" delay="1" string="1" /&gt;
  &lt;/conditional&gt;
  &lt;conditional systemName="IX:RTX:IO:AUTO:00081T" userName="slip NW-E" antecedent="R1 and R2" logicType="1" triggerOnChange="yes"&gt;
    &lt;systemName&gt;IX:RTX:IO:AUTO:00081T&lt;/systemName&gt;
    &lt;userName&gt;slip NW-E&lt;/userName&gt;
    &lt;conditionalStateVariable operator="4" negated="no" type="4" systemName="slip-east" dataString="" num1="0" num2="0" triggersCalc="yes" /&gt;
    &lt;conditionalStateVariable operator="1" negated="no" type="3" systemName="Loop reverse relay" dataString="" num1="0" num2="0" triggersCalc="yes" /&gt;
    &lt;conditionalAction option="1" type="17" systemName="Sv Slip" data="4" delay="1" string="1" /&gt;
  &lt;/conditional&gt;
&lt;/conditionals&gt;
</code></pre></div></div>]]></content><author><name></name></author><category term="trains"/><category term="how-to"/><category term="jmri"/><summary type="html"><![CDATA[How to put a double slip on a JMRI Control Panel]]></summary></entry><entry xml:lang="en-us"><title type="html">Build a smart-fan</title><link href="https://silverailscolo.github.io/en-us/blog/2024/whisper-smart-fan/" rel="alternate" type="text/html" title="Build a smart-fan"/><published>2024-08-03T00:00:00+00:00</published><updated>2024-08-03T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2024/whisper-smart-fan</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2024/whisper-smart-fan/"><![CDATA[<p>To bring fresh air into our bedroom we had a decentral HRU installed, but it was too noisy to catch much sleep…<br/> Because we prefer a temperature of 18˚C, heat recovery in ouw climate zone isn’t that useful. Because space was stille limited, I installe en axial fan with variable speed EC motor connected to an ESP32 the revs it up when the CO<sub>2</sub>-level nears 800 ppm. Read on for our setup:</p> <figure><img src="/assets/img/house/smart/whisper/whisper_complete.jpg" alt="The complete fan install" class="img-fluid"/><figcaption class="kleiner">The complete fan install</figcaption></figure> <h3 id="hardware-used">Hardware used</h3> <ul> <li>Axial fan Ø125mm with variable speed EC motor, eg. the <a href="https://www.ventilatieshop.com/buisventilatoren/whisper-buisventilator/whisper-gold-line-buisventilator-diameter-100mm-125mm-ec-motor-wgle/">Whisper Gold Line EC</a>. You don’t need the 10V controller, but order some spiral tubes, a muffler and connection pieces.</li> <li><a href="https://shop.m5stack.com/products/atom-lite-esp32-development-kit">M5 Stack Atom Lite</a>. A compact 25x25mm SOC with built-in RGB-led and button. I ordered my Atom <a href="https://www.tinytronics.nl/nl/development-boards/microcontroller-boards/met-wi-fi/m5stack-atom-lite-esp32-development-board">here</a></li> <li>USB-A to USB-C cable</li> <li>A <a href="https://www.tinytronics.nl/nl/schakelaars/mosfet's/irf520-breakout-module">IRF520 MOSFET breakout</a> to boost the PWM-signaal from the Atom pin for the 10V= fan control</li> <li><a href="https://www.home-assistant.io">HomeAssistant</a> with <a href="https://esphome.io/guides/getting_started_hassio">ESPHome Add-on</a> IDE to write and install code on the Atom and interact with the unit</li> <li>Automatations on the Atom Lite (ESP32), written with ESPHome, to make it respond to</li> <li>CO<sub>2</sub>-sensor integrated in HomeAssistant, eg. <a href="https://shop.netatmo.com/nl-nl/aircare/home-coach/homecoach">Netatmo Healthy Home Coach</a> (this info can appear in HomeKit too, using the HomeAssistant <a href="https://www.home-assistant.io/integrations/homekit">HomeKit Bridge</a>, but it doesn’t work directly from HomeKit.</li> </ul> <h3 id="co2-meten">CO<sub>2</sub> meten</h3> <p>Place the CO<sub>2</sub> sensor in your bedroom and add the <a href="https://www.home-assistant.io/integrations/homekit_controller">HomeKit Controller</a> integration in HomeAssistant to display the readings and use them to control the fan speed.</p> <div class="row"> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/ha_netamo_homekit.png" alt="Healthy Home integration in HomeAssistant" class="img-fluid"/><figcaption class="kleiner">Healthy Home integration in HomeAssistant</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/ha_co2_sensor.png" alt="Original CO2-graph in HomeAssistant" class="img-fluid"/><figcaption class="kleiner">CO<sub>2</sub> levels without fan</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/ha_co2_control.png" alt="CO2-graph in HomeAssistant with automatic fan" class="img-fluid"/><figcaption class="kleiner">CO<sub>2</sub> levels with the automatic fan</figcaption></figure> </div> </div> <h3 id="fan-connections">Fan connections</h3> <p>Install the fan, ducts and muffler next to your bedroom. I Found a space over the closets in an adjoining guest room, that will profit as well.</p> <p>You will need mains sockets for both the Whisper Gold Line fan and a 5V USB adapter that will power the M5 Stack Atom.</p> <p>The Whisper Gold shipment included a spline box for both 230V power and the 4 control wires:</p> <div class="row"> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/whisper_wiring.jpg" alt="Whisper wiring diagram" class="img-fluid"/><figcaption class="kleiner">Whisper wiring diagram from the manual</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/whisper_wires.jpg" alt="Whisper connections" class="img-fluid"/><figcaption class="kleiner">Whisper connections</figcaption></figure> </div> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/Atom-Whisper-Connections.png" alt="Wiring diagram of all parts" class="img-fluid"/><figcaption class="kleiner">Wiring diagram of all parts</figcaption></figure> </div> <h3 id="m5-atom-lite-connections">M5 Atom Lite connections</h3> <div class="row"> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/atom_lite_wires.jpg" alt="Rear Connector on the Atom Lite" class="img-fluid"/><figcaption class="kleiner">Rear Connector on the Atom Lite</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/atom-lite-installed.jpg" alt="Atom Lite ESP32 controller mounted in room" class="img-fluid"/><figcaption class="kleiner">Atom Lite ESP32 controller mounted in room</figcaption></figure> </div> </div> <p>From the fan I ran 2x2 wires in a piece of UTP-cable to power the Atom with 5V= and connect two pins to control the fan. You need just a single line of four 2.54 mm female sockets at the back of the Atom, see picture. GPIO25 (orange) is our PWM-output. GPIO21 (orange/white) is used as input for the tacho pulse from the fan.</p> <p>After booting, the color of the Lite indicates the CO<sub>2</sub>-level (Green &lt; 500, Red &gt; 800). The brightness of the led shows the fan speed: brighter = faster. A click on the button will set fan operation to manual and increase the speed by 10%. When at 80% the next click sets operation to Automatic, The next click turns the fan off eg. for when you are away for a couple of days.</p> <h3 id="atom-lite-code">Atom Lite code</h3> <p>Download the <a href="/en-us/assets/yaml/whisper/esphome_m5atomlite-whisper.yaml">yaml code</a> and upload it to the M5Stack Atom Lite (ESP32) using the HomeAssistant ESPHome IDE. When this is your first application on the Atom Lite open Chrome browser and navigate to <a href="https://web.esphome.io/?dashboard_wizard">ESPhome Web</a>, connect the USB cable from the Atom to your computer, click Connect and select your USB port.</p> <div class="row"> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/esphome-connect.png" alt="In ESPhome Web, select Connect" class="img-fluid"/><figcaption class="kleiner">In ESPhome Web select Connect</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/esphome-port.png" alt="Select the USB port on your PC" class="img-fluid"/><figcaption class="kleiner">Select the USB port on your PC</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/esphome-prepare.png" alt="Progress of initial install" class="img-fluid"/><figcaption class="kleiner">Progress of initial install</figcaption></figure> </div> </div> <p>The ESP32 configuration consists of:</p> <p>Basic setup:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>esphome:
  name: m5atomlite-whisper
  friendly_name: M5Atom Lite Whisper

globals:
  - id: speed_set_int
    type: int
    restore_value: yes
    initial_value: '4'
  - id: automatic_co2
    type: int
    restore_value: yes
    initial_value: '1'

esp32:
  board: m5stack-atom
  framework:
    type: arduino
</code></pre></div></div> <p>Create a speed_fan object:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fan:
  - platform: speed
    id: whisper_fan
    name: "Slaapkamer Ventilator"
    output: whisper_fan_pwm
    speed_count: 10
    on_turn_on:
      # publish set speed
      - sensor.template.publish:
          id: whisper_speed_step
          state: !lambda 'return id(whisper_fan).speed;'
    on_turn_off:
      # publish set speed
      - sensor.template.publish:
          id: whisper_speed_step
          state: 0
      # set brightness
      - light.turn_off:
          id: led
    on_speed_set:
      # publish set speed
      - sensor.template.publish:
          id: whisper_speed_step
          state: !lambda 'return id(whisper_fan).speed;'
      # set brightness
      - lambda: |-
          // adjust brightness for any speed change
          auto call = id(led).make_call();
          call.set_state(true); // turn the light on if it was off
          auto n = 0.05 * id(speed_set_int);
          call.set_brightness(n);
          call.perform();
</code></pre></div></div> <p>Create a PWM output to control the fan speed:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>output:
  - platform: ledc
    # Fan PWM
    # Connect MOS-SIG to GPIO25, MOS-GND to GND; Whisper yellow to MOS V-, black to OUT-GND, red to OUT+10V
    id: whisper_fan_pwm
    pin:
      number: GPIO25
      inverted: true # MOS V+ did not work. V- did, so inverted PIN
    frequency: 10000Hz # lower if it whines
</code></pre></div></div> <p>A button (switch) to set Automatic operation:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>switch:
  - platform: template
    id: automatic
    name: Automatische regeling
    lambda: |-
      if (id(automatic_co2) == 1){
        return true;
      } else {
        return false;
      }
    turn_on_action:
      then:
      - fan.turn_on:
          id: whisper_fan
      - lambda: |-
          id(automatic_co2) = 1;
          // next block to match thresholds in sensor.co2_measurement block above
          ESP_LOGD("ATOM", "Whisper Auto ON, CO2: %d", id(co2_measurement).state);
          if (id(co2_measurement).state &gt; 1300) {
            id(speed_set_int) = 8;
          } else if (id(co2_measurement).state &gt; 800.0){
            id(speed_set_int) = 7;
          } else if (id(co2_measurement).state &gt; 700.0){
            id(speed_set_int) = 6;
          } else if (id(co2_measurement).state &gt; 600.0){
            id(speed_set_int) = 5;
          } else if (id(co2_measurement).state &gt; 450.0){
            id(speed_set_int) = 4;
          } else if (id(co2_measurement).state &gt; 350.0){
            id(speed_set_int) = 3;
          } else {
            id(speed_set_int) = 0;
          }
          id(whisper_fan).speed = id(speed_set_int);
    turn_off_action:
      then:
      - lambda: |-
          id(automatic_co2) = 0;
</code></pre></div></div> <p>A sensor to fetch CO<sub>2</sub> sensor data from HomeAssistant to the ESP32:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sensor:
  - platform: homeassistant
    id: co2_measurement # this is the ID for a new local sensor, and copies:
    entity_id: sensor.healthy_home_coach_netatmo_carbon_dioxide_sensor  # this points to the front end (Netatmo) entity
    unit_of_measurement: 'ppm'
    filters:
      - round: 0
    on_value_range: # next block to match thresholds in switch.automatic_co2 block below
      - above: 0
        below: 350.0
        then:
          - if:
              condition:
                lambda: return id(automatic_co2) == 1;
              then:
                fan.turn_off:
                  id: whisper_fan
          - light.turn_off:
              id: led
          #- logger.log: CO2 &lt; 350 ppm
      - above: 350.1
        below: 450.0
        then:
          - if:
              condition:
                lambda: return id(automatic_co2) == 1;
              then:
                fan.turn_on:
                  id: whisper_fan
                  speed: 3
          - light.turn_on:
              id: led
              red: 0
              green: 100%
              blue: 0
          #- logger.log: 350 &lt; CO2 &lt; 450 ppm
      # ETC.
      - above: 1300.1
        then:
          - if:
              condition:
                lambda: return id(automatic_co2) == 1;
              then:
                fan.turn_on:
                  id: whisper_fan
                  speed: 8
          - light.turn_on:
              id: led
              red: 100%
              green: 0%
              blue: 50%
          #- logger.log: WARNING CO2 &gt; 1300 ppm
</code></pre></div></div> <p>When the fan is in Automatic mode, the code will adjust the fan speed every time it receives a new CO<sub>2</sub> reading from the bedroom. It also updates the color of the LED (Green = clean to Brown = dirty).</p> <p>The tachometer sensor provides feedback on the actual Whisper fan speed (3 pulses per revolution, so we have the <code class="language-plaintext highlighter-rouge">multiply: 0.33</code> filter):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sensor:
  - platform: pulse_counter # -meter too many data points
    # toerenteller Whisper witte draad
    name: Toerental
    id: whisper_toerental
    pin:
      number: GPIO21
      # inverted: true
      mode:
        input: true
        pullup: true
    unit_of_measurement: 't/min'
    internal_filter: 5us
    update_interval: 10s
    filters:
      - multiply: 0.33 # (3 ticks per revolution as per Whisper Gold manual)
      - round: 0
</code></pre></div></div> <h3 id="home-assistant-settings">Home Assistant settings</h3> <p>Back in HomeAssistant open the YAML-editor mode of a new Dashboard and paste in this <a href="assets/yaml/whisper/homeassistant_whisper_dashboard.yaml">yaml code</a> to create the fan control UI.</p> <p>Adapt the entity names to your setup, eg.</p> <ul> <li>The name of your CO<sub>2</sub> sensor</li> <li>The numbers for your speed_fan, fan sensors and -switches</li> </ul> <div class="row"> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/whisper_ha_dashboard.jpg" alt="HA Whisper fan Dashboard" class="img-fluid"/><figcaption class="kleiner">Whisper Fan Dashboard in HomeAssistant</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/whisper/HA-whisper-speed-graph.png" alt="Fan speed reacts to CO2 measurements" class="img-fluid"/><figcaption class="kleiner">Fan speed reacts to CO2 measurements</figcaption></figure> </div> </div> <p>I wish you all fresh nights!</p>]]></content><author><name></name></author><category term="software"/><category term="hardware"/><category term="smart-home"/><summary type="html"><![CDATA[To bring fresh air into our bedroom we had a decentral HRU installed, but it was too noisy to catch much sleep… Because we prefer a temperature of 18˚C, heat recovery in ouw climate zone isn’t that useful. Because space was stille limited, I installe en axial fan with variable speed EC motor connected to an ESP32 the revs it up when the CO2-level nears 800 ppm. Read on for our setup:]]></summary></entry><entry xml:lang="en-us"><title type="html">Build an AGA Cooker Display</title><link href="https://silverailscolo.github.io/en-us/blog/2024/smartovendisplay/" rel="alternate" type="text/html" title="Build an AGA Cooker Display"/><published>2024-04-25T00:00:00+00:00</published><updated>2024-04-25T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2024/smartovendisplay</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2024/smartovendisplay/"><![CDATA[<p>As you may have read <a href="/en-us/house/smart.html#oven">here</a>, I wanted to build a reminder/indication for our AGA kitchen stove. This was my solution.</p> <figure><img src="/assets/img/house/smart/aga/agadisplay_IMG9388.jpg" alt="The finished display in use" class="img-fluid"/><figcaption class="kleiner">The finished display</figcaption></figure> <h3 id="hardware-items-needed">Hardware items needed</h3> <ul> <li><a href="https://www.raspberrypi.com/documentation/microcontrollers/raspberry-pi-pico.html">Raspberry Pico W</a></li> <li><a href="https://www.waveshare.com/wiki/Pico-OLED-1.3">Waveshare 1.3” Pico OLED</a> display</li> <li>USB-A to USB-C cable</li> <li><a href="https://thonny.org">Thonny IDE</a> for <a href="https://micropython.org">MicroPython</a> to program the picoW</li> <li><a href="https://www.home-assistant.io">HomeAssistant</a> providing energy use via <a href="https://mqtt.org">MQTT</a> messages</li> <li>Automations set up in HomeAssistant responding to</li> <li>Current sensing input for your stove to HomeAssistant, eg. <a href="https://www.myenergi.com/product/harvi/">myenergi harvi</a> (2 CT clamps minimum on 3 Phase install)</li> </ul> <h3 id="current-sensing">Current Sensing</h3> <p>Near the switch board or in another safely accessible location, mount 2-3 CT-clamps on the feeders to the AGA stove. I ordered compact myenergi clamps.</p> <div class="row"> <div class="col-sm"> <figure><img src="/assets/img/house/smart/aga/CT_clamps-IMG_9186.jpg" alt="CT clamps behind fuse box" class="img-fluid"/><figcaption class="kleiner">CT clamps behind fuse box</figcaption></figure> </div> <div class="col-sm"> <figure><img src="/assets/img/house/smart/aga/harvi_inside-IMG_9183.jpg" alt="connections inside harvi" class="img-fluid"/><figcaption class="kleiner">CT2/3 connections inside harvi</figcaption></figure> </div> </div> <p>I connected the CT clamp wires to the unused inputs of my harvi, which show up as sensors in the Home Assistant myenergi integration.</p> <h3 id="code">Code</h3> <p>Download the <a href="/en-us/assets/python/ovendisplay-main.py">micropython code</a> and load it onto the PicoW using the Thonny application. Or view it as a <a href="https://gist.github.com/silverailscolo/251de664985824c1d1ddeaad54f00b6d">GitHub Gist</a>.</p> <h3 id="home-assistant-set-up">Home Assistant set-up</h3> <p>In HomeAssistant, create input_number definitions in configuration.yaml;</p> <figure><img src="/assets/img/house/smart/aga/ha_ct2_inputnumber.png" alt="HA CT2 Input Settings Pane" class="img-fluid"/><figcaption class="kleiner">CT2 Input Settings Pane</figcaption></figure> <p>Add ON/OFF Automations for each element of your stove, for example to signal Baking Oven was turned ON:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alias: AGA Baking Oven ON
description: ""
trigger:
- platform: numeric_state
  entity_id:
  - sensor.ct2_actueel_vermogen
    above: 820
    below: 960
    condition: []
    action:
- service: input_boolean.turn_on
  data: {}
  target:
  entity_id: input_boolean.aga_baking_oven
  mode: single
</code></pre></div></div> <p>In HomeAssistant, add binary input_boolean (On/Off) sensors for each item on your stove, for example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alias: AGA turns OFF CT2
description: ""
trigger:
- platform: numeric_state
  entity_id:
  - input_number.ct2_actueel
    below: 1
    for:
    hours: 0
    minutes: 1
    seconds: 0
- platform: numeric_state
  entity_id:
  - sensor.ct2_ct3
    below: 1
    for:
    hours: 0
    minutes: 1
    seconds: 0
    condition: []
    action:
- service: input_boolean.turn_off
  data: {}
  target:
  entity_id:
  - input_boolean.aga_grill
  - input_boolean.aga_baking_oven
  - input_boolean.aga_roasting_oven
  mode: single
</code></pre></div></div> <figure><img src="/assets/img/house/smart/aga/ha_bakingoven_input_setting.png" alt="HA Oven Input Setting Pane" class="img-fluid"/><figcaption class="kleiner">Input Oven Setting Panel</figcaption></figure> <p>Add MQTT topics in HomeAssistant configuration.yaml:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mqtt_statestream:
base_topic: homeassistant
publish_attributes: false
publish_timestamps: false
include:
  entities:
    - input_boolean.aga_warming_oven
    - input_boolean.aga_boiling_plate
    - input_boolean.aga_simmer_plate
    - input_boolean.aga_baking_oven
    - input_boolean.aga_roasting_oven
    - input_boolean.aga_grill
entity_globs:
  - input_boolean.aga_*

# MQTT subscribe to PicoW
mqtt:
sensor:
- name: "Timer A"
unique_id: "timer_a"
state_topic: "picow/timerA/running"
- name: "Timer B"
unique_id: "timer_b"
state_topic: "picow/timerB/running"
</code></pre></div></div> <p>More on MQTT for sensors from PicoW micropython <a href="https://github.com/agners/micropython-ha-mqtt-device">here</a></p> <p>Adapt for your use case, eg.</p> <ul> <li>MQTT messages format</li> <li>Connection names and trigger currents of your stove elements (look at sensor.ct2_ above)</li> </ul> <p>Because the <a href="https://www.myenergi.com/product/harvi/">myenergi harvi</a> is powered from the CT clamps, a bit more tweaking is required.</p> <p>To reset the current sensors to zero when no PV or AGA current is flowing through the clamps, I created a 2 minute timer that is reset every minute as a (non-zero) measurement from the myenergi server arrives in Home Assistant myenergi integration. When this timer eventually runs out, it means neither the PV panels nor the stove is consuming any power, and an automation sets <code class="language-plaintext highlighter-rouge">input_number.ct2_actueel</code> and <code class="language-plaintext highlighter-rouge">input_number.ct3_actueel</code> back to zero.</p> <p>If you need those details, open an <a href="https://github.com/silverailscolo/ejb/issues">Issue</a> on this site.</p>]]></content><author><name></name></author><category term="software"/><category term="hardware"/><category term="smart-home"/><summary type="html"><![CDATA[As you may have read here, I wanted to build a reminder/indication for our AGA kitchen stove. This was my solution.]]></summary></entry><entry xml:lang="en-us"><title type="html">Website has moved</title><link href="https://silverailscolo.github.io/en-us/blog/2024/migrating-site/" rel="alternate" type="text/html" title="Website has moved"/><published>2024-04-22T00:00:00+00:00</published><updated>2024-04-22T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2024/migrating-site</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2024/migrating-site/"><![CDATA[<p>I rounded up migrating my website, blog and photo library as an integrated experience served from Jekyll. Goodbye Wordpress and Piwigo updates and security side jobs.</p> <p>I serve two languages: NL and EN-US, originally for my US model railroad stuff. And you can choose from Light and Dark theme.</p> <p>Also includes captions read directly from image file metadata (sorry, these are not i18n. I tried, but that was too much for now).</p> <p>Have a look around, and report any - serious - hick-ups as an <a href="https://github.com/silverailscolo/ejb/issues">Issue</a></p> <h2 id="subscribe-to-my-atom-rss-like-feed">Subscribe to my Atom (RSS-like) Feed</h2> <p>The Atom (RSS-like) feed is reachable simply by typing <code class="language-plaintext highlighter-rouge">silverailscolo.github.io/ejb/feed.xml</code></p>]]></content><author><name></name></author><summary type="html"><![CDATA[I rounded up migrating my website, blog and photo library as an integrated experience served from Jekyll. Goodbye Wordpress and Piwigo updates and security side jobs.]]></summary></entry><entry xml:lang="en-us"><title type="html">Tidbits</title><link href="https://silverailscolo.github.io/en-us/blog/2024/tidbits/" rel="alternate" type="text/html" title="Tidbits"/><published>2024-04-22T00:00:00+00:00</published><updated>2024-04-22T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2024/tidbits</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2024/tidbits/"><![CDATA[<ul> <li><a href="https://fluithaasbio-nl.webnode.nl/">Fluithaas</a> by our youngest (2014)</li> <li><a href="https://www.ebroerse.nl/Verborgen_sleutels/Home.html">Verborgen Sleutels</a> online game, another idea from our youngest</li> <li><a href="https://www.chaosofdelight.org/">A Chaos of Delight</a> delight over small critters at the base of life</li> </ul>]]></content><author><name></name></author><category term="education"/><category term="nature"/><summary type="html"><![CDATA[Fluithaas by our youngest (2014) Verborgen Sleutels online game, another idea from our youngest A Chaos of Delight delight over small critters at the base of life]]></summary></entry><entry xml:lang="en-us"><title type="html">Reading EXIF tags in Jekyll with exiftools</title><link href="https://silverailscolo.github.io/en-us/blog/2024/reading-exif-in-jekyll/" rel="alternate" type="text/html" title="Reading EXIF tags in Jekyll with exiftools"/><published>2024-04-19T00:00:00+00:00</published><updated>2024-04-19T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2024/reading-exif-in-jekyll</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2024/reading-exif-in-jekyll/"><![CDATA[<p>As I am migrating this site to Jekyll / GitHub pages, I am integrating data that was separate (and under the hood) up to now. That requires a bit of scripting, with minimal re-entry of stuff.</p> <p>An important example are my pictures, that I once managed in <a href="https://www.extensis.com/portfolio">Extensis Portfolio</a>, and later as separate files on a local HD.</p> <p>It would be nice to provide a caption with each photo I add to the site, and as I remembered that I once put keywords and captions for many images into the image files as EXIF tags, I now try to read those fields from the images and apply them as captions in the lightGallery slide shows, like <a href="/en-us/assets/art_gallery/sketches/">here</a>.</p> <p>A lot of (old) tools are available to extract the EXIF tags, but Portfolio used other fields… After EXIF came IPTC tags, used for GPS lat/long data, title etc. IPTC is sparsely supported bij ruby tools. And as it happens, my image captions are in so called XMP tags, for which just a few tools provide support.</p> <p>To make things more complicated, modern image management tools like Adobe <a href="https://www.adobe.com/nl/products/photoshop-lightroom.html">Lightroom</a> and <a href="https://www.digikam.org/">DigiKam</a> allow you to enter labels in XMP and copy those strings to EXIF respectively. (although XMP allows for longer strings, and EXIF only allows for printable ASCII character, so where do the ü and Ø go in the process?)</p> <p>Today I discovered a tool called <a href="https://exiftool.org/">exiftool</a>, that finally will give me access to my cherished image captions. From inside Jekyll you can use it through the <a href="https://rubygems.org/gems/exiftool/versions/1.2.5">exiftool gem</a>. After a bit of fiddling, I am now able to display all text fields stored in a picture file, and automatically copy it to the html code for one of my web galleries. Exiftool Docs warn that the three tag types overlap, unless you ask for <code class="language-plaintext highlighter-rouge">-all</code> tags. If we focus on the caption and the copyright fields, these are the specific tag names to fetch:</p> <table> <thead> <tr> <th>Type</th> <th>Caption field name</th> <th>Copyright field name</th> <th>Used</th> </tr> </thead> <tbody> <tr> <td>EXIF</td> <td>user_comment</td> <td>copyright</td> <td> </td> </tr> <tr> <td>IPTC</td> <td>“caption-abstract”</td> <td>copyright_notice</td> <td>&lt;–</td> </tr> <tr> <td>XMP</td> <td>description</td> <td>rights</td> <td> </td> </tr> </tbody> </table> <p>In Ruby code that makes for:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>require 'exiftool'
...
exiftoolbatch = Exiftool.new(Dir["#{Dir.pwd + '/' + dir}/*.*"]) # we are in original_dir
...
exif =  exiftoolbatch.result_for(fullpath)
...
capt = exif[:"caption-abstract"]
copy = exif[:copyright]
</code></pre></div></div>]]></content><author><name></name></author><category term="software"/><category term="computers"/><summary type="html"><![CDATA[As I am migrating this site to Jekyll / GitHub pages, I am integrating data that was separate (and under the hood) up to now. That requires a bit of scripting, with minimal re-entry of stuff.]]></summary></entry><entry xml:lang="en-us"><title type="html">Favorite titles</title><link href="https://silverailscolo.github.io/en-us/blog/2024/bookfavorites/" rel="alternate" type="text/html" title="Favorite titles"/><published>2024-04-11T00:00:00+00:00</published><updated>2024-04-11T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2024/bookfavorites</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2024/bookfavorites/"><![CDATA[ <p>Titles of some of my favorite books:</p> <figure><img src="/assets/img/blog/20240411_favbooks.jpg" alt="The books" class="img-fluid"/></figure> <ul> <li><em><a href="https://legacy.iftf.org/smartcities/">Smart Cities</a></em> by Anthony Townsend, Norton 2014.</li> <li><em><a href="https://archive.org/details/architectureofwe00banh/page/n2/mode/1up">The Architecture of the Well-tempered Environment</a></em>, by Reyner Banham 06/2014</li> <li><em><a href="https://en.m.wikipedia.org/wiki/The_Oxford_Book_of_Modern_Science_Writing">The Oxford Book of Modern Science Writing</a></em>, by Richard Dawkins</li> <li><em><a href="">The Age of Wonder</a></em>, by Richard Holmes 02/2010</li> <li><em><a href="https://en.m.wikipedia.org/wiki/Dark_Age_Ahead">Dark age ahead</a></em>, by Jane Jacobs 01/2008</li> <li><em><a href="https://psycnet.apa.org/record/2001-00419-000">The ape and the sushi master: Cultural reflections of a primatologist</a></em>, by Frans de Waal 11/2007</li> <li><em><a href="https://www.geertmak.nl/en/books/in-europa-in-europe/">In Europe</a></em>, by Geert Mak: history of our continent 08-10/2004</li> </ul> <h2 id="find-books-about-a-city">Find books about a city</h2> <ul> <li><a href="https://readingthecity.com/">Reading the City</a></li> </ul>]]></content><author><name></name></author><category term="books"/><category term="dawkins"/><summary type="html"><![CDATA[&lt;!– SPDX-FileCopyrightText: 2024-2025 EJ Broerse]]></summary></entry><entry xml:lang="en-us"><title type="html">Open Source</title><link href="https://silverailscolo.github.io/en-us/blog/2024/opensourcelinks/" rel="alternate" type="text/html" title="Open Source"/><published>2024-04-11T00:00:00+00:00</published><updated>2024-04-11T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2024/opensourcelinks</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2024/opensourcelinks/"><![CDATA[<p>A couple of projects that I support and contribute to:</p> <ul> <li><a href="https://jmri.sourceforge.net/">JMRI</a>, Java Model Railroad Interface, to control and run a DCC model railroad</li> <li><a href="https://www.freecad.org">FreeCAD</a> open source 3D BIM, discovering how to model</li> </ul>]]></content><author><name></name></author><category term="software"/><category term="macos"/><category term="open-source"/><summary type="html"><![CDATA[A couple of projects that I support and contribute to:]]></summary></entry><entry xml:lang="en-us"><title type="html">Goodbye Hypersite</title><link href="https://silverailscolo.github.io/en-us/blog/2024/goodbye-hypersite/" rel="alternate" type="text/html" title="Goodbye Hypersite"/><published>2024-03-22T00:00:00+00:00</published><updated>2024-03-22T00:00:00+00:00</updated><id>https://silverailscolo.github.io/blog/2024/goodbye-hypersite</id><content type="html" xml:base="https://silverailscolo.github.io/blog/2024/goodbye-hypersite/"><![CDATA[<p>To archive an application that I created and ported over the years, here is the final readme of Hypersite.</p> <h1>What is HyperSite and how does it work?</h1> <p>HyperSite is a stack that helps you maintain your own website pages. Finding a provider and creating a few html pages is no big deal. But it does take effort to ‘just’ update the content, including the date in the footer etc.</p> <p>But if you fail to update your site regularly, visitors will look elsewhere. Now that would be a shame, as this HyperCard stack is not expensive and a rather simple CMS to manage your site contents.<br/> Quiclky add a few lines, add a new background image to a page (remember that?) and preview the changes in your local browser before uploading it with a single click; Done!<br/> (See <a href="#beperkingen">Limitations</a> as for what can <em>not</em> do).</p> <div class="normal-nc"> <a href="#principe">Principle</a> | <a href="#instructies">Instructions</a> | <a href="#historie">History</a> | <a href="#credits">Credits</a> </div> <h2 id="principe">Principle</h2> <p>What is HyperSite? With this stack you can - within a fixed layout consisting of a 2-column table and a menu with links to the other pages - edit, format and save the content of each page as an html file. Take a look at a small example.</p> <figure><img src="/assets/img/blog/HyperSite-p0.gif" alt="HyperSite start screen" class="img-fluid"/><figcaption class="kleiner">HyperSite start screen</figcaption></figure> <p>For each page of your web-site there is a separate card, on which you can enter your own information in 4 text fields. As far as you can influence the formatting within the standard HTML 3.2, a number of tools are available via a series of buttons at the bottom left of the screen. There are also buttons to create ‘links’ and ‘anchors’.</p> <p>General information that is the same for each page can be entered in the ‘General settings’ card. If you then click on the ‘Create HTML’ button, a complete HTML file will be created on the hard disk from all that data. Via the ‘Upload…” you can then send those files to your provider. Click on the ‘Start’ button at the top right of this screen to continue…</p> <p>This stack uses other programs, which need to be installed on your computer:</p> <ul> <li>a web browser, like Safari or Firefox;</li> <li>an FTP-program, like Transmit by <a href="https://www.panic.com">Panic</a>;</li> <li>a graphics program to create or adapt images for the web, like Macromedia Xres (remember that one?), Photoshop or Graphic Converter.</li> </ul> <h2 id="instructies">Instructions</h2> <figure><img src="/assets/img/blog/HyperSite-p1.gif" alt="HyperSite Algemeen scherm" class="img-fluid"/><figcaption class="kleiner">HyperSite Algemeen scherm</figcaption></figure> <h3 id="1-click-the-start-button">1. Click the “Start” button</h3> <p>Fill in at least the following information:</p> <ul> <li>a name for each page of your site, which will then appear as TABs at the top (use only lowercase letters and no spaces);</li> <li>A "local path", i.e. the place on your hard drive where all files associated with your site are (temporarily) stored. Because of the way HyperSite works, there should be a second folder called "Images" in this folder. This is where you save all the images, so that the root folder remains well organized (thanks to Claris HomePage);</li> <li>your E-mail address;</li> <li>your internet browser (use a dialog box to point out where it is located on your computer);</li> <li>a Fetch bookmark, which connects to your place on the server;</li> <li>an Applescript file that starts the Internet connection with your ISP, e.g. the "PPP start" script in the "AppleScript Tools" folder.</li> </ul> <p>Not mandatory:</p> <ul> <li>the name of a.GIF image that appears as a title on all pages, e.g. your logo;</li> <li>The name of a.GIF image that comes as a 'bullet' for each of the 4 text blocks.</li> </ul> <h3 id="2-continue-by-clicking-on-the-first-tab-slip-at-the-top-left">2. Continue by clicking on the first tab slip at the top left</h3> <p>Fill in the Name and Title for this page, and possibly. A background image or color. For each page, type the information you want to show in text boxes 1 through 4. A field can also be left empty.<br/> Minimal HTML knowledge: After each line insert a line break &lt;br&gt; and around paragraphs insert &lt;p&gt;…&lt;/p&gt;, otherwise all text will be one block.</p> <h3 id="3-assign-extra-markup">3. Assign extra markup</h3> <p>Select a text fragment with the mouse and click on one of the ‘buttons’ in the ‘Toolbox’ at the bottom left. For details refer to the <a href="#toolbox">Toolbox</a> section.</p> <h3 id="4-special-characters">4. Special characters</h3> <p>If there are ‘special’ characters in your text, for example “ü” and “é”, select them and click on the “ASCI to ISO” button to make sure that these characters appear clearly for everyone to see. If you click on this button without making a selection, all the text will be checked, but it will take some time.</p> <h3 id="5-when-youre-done-with-a-page">5. When you’re done with a page</h3> <p>Click on the “Create HTML” button. From all the information in the stack, an HTML file is created, the standard language of the world wide web. A text message will appear with the name of the file, which is the same as the name of your page + the extension “.html”. To export all pages as HTML files at once, hold down the Option key while clicking the “Create HTML” button.</p> <h3 id="6-preview">6. Preview</h3> <p>After the page(s) in question has been saved, you can choose on the screen whether or not to view the page locally in your web browser, previously filled in on the ‘General’ card. There must be enough free memory to open the browser.</p> <h3 id="7-upload">7. Upload</h3> <p>If everything is OK, the last step is to “upload” your page + associated images to your provider, i.e. copy them from your hard drive to your piece of your provider’s internet server. To do this, you usually use a separate FTP program, such as Transmit or Fetch. Transmit v 1.6 - a very nice program - can be found at <a href="https://www.panic.com">https://www.panic.com</a>.</p> <figure><img src="/assets/img/blog/HyperSite-p3.gif" alt="HyperSite input screen example" class="img-fluid"/><figcaption class="kleiner">HyperSite input screen example</figcaption></figure> <h4><a id="toolbox">The Toolbox</a></h4> <p>The HyperSite Toolbox consists of a number of buttons and pop-up menus that are located in the rectangle at the bottom left of each card.<br/> On the left side are all formatting functions, e.g. to make text bold or italicized. You can also specify the size of text and the color. To do this, you always have to select a text section first, otherwise you will only hear a warning sound.</p> <p>On the right are buttons to apply hyperlinks. A hyperlink is text that you can click on to jump somewhere else, e.g. a place elsewhere on your site (“anchor”, see below) or a completely different web-site (URL).<br/> A link consists of 2 parts, i.e. the underlined word, which appears on the screen, and the real goal, often in the form of a URL address, e.g. “https://www.apple.com” (= Apple). If you select a piece of text before clicking on the button, that piece will be used as underlined text, and all you have to do is indicate the goal in the dialog box.</p> <p>To mark a spot on one of your own pages as a target, insert an anchor, which consists of a special “tag” with a short name, which is not shown in a browser. All the anchors you have added to your stack up to that point will appear in a menu when you click on the anchor button. You can insert them as a hyperlink somewhere else.</p> <p>Put the insertion point in the right place and click on the button with the face to insert a certain type of image on your page. You can choose from 3 types:</p> <ol> <li>GIF and JPEG files can be displayed directly in any graphical browser;</li> <li>QuickTime are videos that a person can only watch if he/she has loaded Apple's QuickTime plugin;</li> <li>Shockwave are animations (e.g. Macromedia Flash and Director), which also require a plug-in in Netscape and ActiveX and JAVA technology in Internet Explorer.</li> </ol> <h4><a id="beperkingen">Constraints</a></h4> <p>The following items are not included in HyperSite:</p> <ul> <li>edit images and convert them to.GIF format (use Xres or the like);</li> <li>WYSIWYG formatting without seeing all tags (but preview via browser);</li> <li>apply external links via pop-up menu (use cut &amp; paste);</li> <li>a graphical overview of all pages and links (which is nice);</li> </ul> <p>Features I hope to add:</p> <ul> <li>alignment options (a working menu)</li> <li>(partial) check of all links (for now, use <a href="http://validator.w3.org/checklink">W3C Checklink</a> [tested 2/2/2010].</li> </ul> <h2 id="historie">History</h2> <h4>Use case</h4> <p>As I tried various HTML editors, I realized that I would be better off creating a simple and limited program with HyperCard for my specific needs. Within 1 consistent layout, I can focus on the content, while this stack handles all the side issues: navigation links to the other pages of my site, changing the date of last modification, giving all pages a different color or bullet in 1 go, etc. At the same time, I learned a bit more about HTML 3.2, XHTML and even HTML5…</p> <p>So this is what it has become, instead of about 4 pages for myself, already more than 6, and a lot more options than I had thought of initially.</p> <h4>Versions</h4> <dl> <dt>v 0.6 (March 1998)</dt> <dd>slowly built up using sample output from a commercial HTML editor.</dd> <dt>v 0.7 (May ‘98)</dt> <dd>finally does what I wanted, but wasn’t without bugs.</dd> <dt>v 0.8 (July 1998)</dt> <dd>some improvements (bug in tag fixed, speed ASCII conversion, correctly working tab strips at the top of the screen) and some additional wishes based on my own experience with the program (convert all pages in 1 click + option key, create tables within a field).</dd> <dt>v 1.0 (October 1998)</dt> <dd>contains extra options, e.g. whether or not to show the menu at the top left (for a different layout on the 1st page of a Site), to show the fixed image + header at the top right (ditto). Furthermore, some additional tools, o.a. HTML comment. Also fixed some minor bugs and strict HTML rules.</dd> <dt>V 1.1 and 1.2 (May-June ‘99)</dt> <dd>contains gradual improvements, e.g. to store parts of the site in subfolders - e.g. “docs:” - and still create all ‘links’ correctly.</dd> <dt>v 1.3 (Aug. ‘99)</dt> <dd>adds the ability to use JavaScript to use JavaScript ‘roll over’ effects to light up a navigation menu under your mouse (“hilite”). That’s now standard on the web, that’s why. For fast sites, you can always turn it off on the ‘General’ page. Also new is the ability to divide a part of the site into folders, completing the references to general interface and menu links via the “base URL” field. Furthermore, support for the “Language” Meta-Tag via a pop-up menu on the card “General” and a central Style Sheet (called “hyperstyle.css”) on the same map to control all formatting in 1 place using “Cascading Style Sheets” from HTML 4.0. For more info, see a good book on this subject. Also, the Tag for including Macromedia Flash images has been adjusted according to the latest information. DTD version in header: ‘HTML 4.0 Transitional’.</dd> <dt>v 1.5 (August 2000)</dt> <dd>Adds the ability to customize all backgrounds at once. Also added some extra tags to the toolbox: DIV and JS = JavaScript.</dd> <dt>v 1.6 (April 2001)</dt> <dd>Resolves some errors in the use of graphical (.GIF) buttons, so that unnecessary error messages do not occur. Also insert bottom cabinet HTML tags according to XHTML 1.0 specification, e.g. &lt;br /&gt;. The pretection of the first 2 screens has also been improved; you can only get there if you explicitly click on the <strong>?</strong> or <strong>General</strong> button.</dd> <dt>v 1.8</dt> <dd>complete port of Apple HyperCard stack to LiveCode.</dd> <dt>v 1.9 van 2018-2023</dt> <dd>HTML5 correct, including a responsive layout and w3 CSS styles.</dd> </dl> <figure><img src="/assets/img/blog/RevHyperSite21.png" alt="Revolution HyperSite screen" class="img-fluid"/><figcaption class="kleiner">Revolution HyperSite screen</figcaption></figure> <h2 id="credits">Credits</h2> <p>This stack is shareware. Support the development of these helpful programs by paying your shareware fee. Please pay Euro 25,- next time you see me.</p> <p>All programming © E.J. Broerse 04/1998 - 07/1998 - 09/1999 - 03/2000 - 04/2001 - 11/2002 - 02-2023 except <i>PopUpMenu XCMD</i> © Individual Software, Inc. 1988.</p>]]></content><author><name></name></author><category term="software"/><category term="macintosh"/><category term="hypercard"/><summary type="html"><![CDATA[To archive an application that I created and ported over the years, here is the final readme of Hypersite.]]></summary></entry></feed>